<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tes Mindfulness Profesional</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --bg-color: #f6fdfc;
            --primary-color: #02504e;
            --accent-color: #00a896;
            --text-color: #1a1a1a;
            --scale-text: #4b5563;
            --white: #ffffff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 1rem;
        }
        
        header {
            text-align: center;
            margin-bottom: 2rem;
            width: 100%;
            max-width: 800px;
        }
        
        h1 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .subtitle {
            color: var(--accent-color);
            font-size: 1rem;
            font-weight: 500;
        }
        
        main {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .card {
            background-color: var(--white);
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            width: 100%;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }
        
        .intro-card {
            text-align: center;
        }
        
        .intro-card p {
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .question-card {
            display: none;
        }
        
        .question-number {
            color: var(--accent-color);
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
        
        .scale-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .scale-options {
            display: flex;
            justify-content: space-between;
            gap: 0.5rem;
        }
        
        .scale-option {
            flex: 1;
            text-align: center;
        }
        
        .scale-option input[type="radio"] {
            display: none;
        }
        
        .scale-option label {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 0.75rem 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            gap: 0.5rem;
        }
        
        .scale-option label:hover {
            background-color: rgba(0, 168, 150, 0.1);
        }
        
        .scale-option input[type="radio"]:checked + label {
            background-color: rgba(0, 168, 150, 0.2);
            font-weight: 500;
        }
        
        .scale-circle {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e5e7eb;
            color: var(--text-color);
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .scale-option input[type="radio"]:checked + label .scale-circle {
            background-color: var(--accent-color);
            color: white;
        }
        
        .scale-label {
            font-size: 0.8rem;
            color: var(--scale-text);
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 1rem;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        button:hover {
            background-color: var(--accent-color);
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: #cbd5e1;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }
        
        .btn-secondary:hover {
            background-color: rgba(2, 80, 78, 0.1);
            color: var(--primary-color);
        }
        
        .progress-container {
            width: 100%;
            margin-bottom: 1.5rem;
        }
        
        progress {
            width: 100%;
            height: 0.5rem;
            border-radius: 1rem;
            overflow: hidden;
        }
        
        progress::-webkit-progress-bar {
            background-color: #e5e7eb;
            border-radius: 1rem;
        }
        
        progress::-webkit-progress-value {
            background-color: var(--accent-color);
            border-radius: 1rem;
        }
        
        #namaInputSection {
            display: none;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
        }
        
        #namaInputSection label {
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        #namaInputSection input {
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            width: 100%;
        }
        
        #namaInputSection input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(0, 168, 150, 0.2);
        }
        
        #resultCard {
            display: none;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .result-score {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary-color);
            text-align: center;
            margin: 1rem 0;
        }
        
        .result-category {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent-color);
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .result-explanation {
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .recommendation {
            background-color: rgba(0, 168, 150, 0.1);
            border-left: 4px solid var(--accent-color);
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 0 0.5rem 0.5rem 0;
        }
        
        .recommendation h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .recommendation ul {
            padding-left: 1.5rem;
        }
        
        .recommendation li {
            margin-bottom: 0.5rem;
        }
        
        .warning-box {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 0 0.5rem 0.5rem 0;
        }
        
        .final-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        @media (max-width: 640px) {
            .scale-options {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .scale-option label {
                flex-direction: row;
                justify-content: space-between;
            }
            
            .navigation {
                flex-direction: column;
                gap: 1rem;
            }
            
            .navigation button {
                width: 100%;
                justify-content: center;
            }
            
            .final-actions {
                flex-direction: column;
            }
            
            .final-actions button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-brain"></i> Tes Mindfulness Profesional</h1>
        <p class="subtitle">Evaluasi kesadaran dan kehadiran dalam kehidupan sehari-hari</p>
    </header>
    
    <main>
        <div class="card intro-card" id="introCard">
            <h2>Selamat Datang</h2>
            <p>Tes ini terdiri dari 50 pertanyaan yang dirancang untuk mengukur tingkat mindfulness Anda. Jawablah setiap pertanyaan dengan jujur sesuai dengan pengalaman Anda sehari-hari.</p>
            <p>Waktu pengerjaan sekitar 10-15 menit. Tidak ada jawaban benar atau salah dalam tes ini.</p>
            <button id="startButton" onclick="startTest()">
                <i class="fas fa-play"></i> Mulai Tes
            </button>
        </div>
        
        <div class="card question-card" id="questionCard">
            <div class="progress-container">
                <progress id="progressBar" value="1" max="50"></progress>
                <div class="question-number">Pertanyaan <span id="currentNumber">1</span> dari 50</div>
            </div>
            
            <div class="question-text" id="questionText">
                <!-- Question text will be inserted here -->
            </div>
            
            <div class="scale-container">
                <div class="scale-options" id="scaleOptions">
                    <div class="scale-option">
                        <input type="radio" name="answer" id="option1" value="1">
                        <label for="option1">
                            <div class="scale-circle">1</div>
                            <div class="scale-label">Tidak Pernah</div>
                        </label>
                    </div>
                    <div class="scale-option">
                        <input type="radio" name="answer" id="option2" value="2">
                        <label for="option2">
                            <div class="scale-circle">2</div>
                            <div class="scale-label">Jarang</div>
                        </label>
                    </div>
                    <div class="scale-option">
                        <input type="radio" name="answer" id="option3" value="3">
                        <label for="option3">
                            <div class="scale-circle">3</div>
                            <div class="scale-label">Kadang-kadang</div>
                        </label>
                    </div>
                    <div class="scale-option">
                        <input type="radio" name="answer" id="option4" value="4">
                        <label for="option4">
                            <div class="scale-circle">4</div>
                            <div class="scale-label">Sering</div>
                        </label>
                    </div>
                    <div class="scale-option">
                        <input type="radio" name="answer" id="option5" value="5">
                        <label for="option5">
                            <div class="scale-circle">5</div>
                            <div class="scale-label">Sangat Sering</div>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="navigation">
                <button class="btn-secondary" id="prevButton" onclick="prevQuestion()" disabled>
                    <i class="fas fa-arrow-left"></i> Sebelumnya
                </button>
                <button id="nextButton" onclick="nextQuestion()" disabled>
                    Selanjutnya <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <div class="card" id="namaInputCard" style="display: none;">
            <h2>Hampir Selesai!</h2>
            <p>Terima kasih telah menyelesaikan semua pertanyaan. Silakan masukkan nama Anda untuk melihat hasil.</p>
            
            <div id="namaInputSection" style="display: flex;">
                <label for="userName"><i class="fas fa-user-edit"></i> Masukkan Nama Anda:</label>
                <input type="text" id="userName" placeholder="Contoh: Aisyah Rahmah" required>
                <button onclick="tampilkanHasil()">
                    <i class="fas fa-check-circle"></i> Lihat Hasil
                </button>
            </div>
        </div>
        
        <div class="card" id="resultCard">
            <div class="result-header">
                <h2>Hasil Tes Mindfulness</h2>
                <h3>Nama: <span id="displayUserName"></span></h3>
                <p>Tanggal: <span id="testDate"></span></p>
            </div>
            
            <div class="result-score">
                <span id="finalScore">0</span>/250
            </div>
            
            <div class="result-category" id="resultCategory">
                <!-- Category will be inserted here -->
            </div>
            
            <div id="validationWarning" class="warning-box" style="display: none;">
                <p><i class="fas fa-exclamation-triangle"></i> <strong>Perhatian:</strong> Terdeteksi inkonsistensi jawaban, hasil mungkin tidak akurat.</p>
            </div>
            
            <div class="result-explanation" id="resultExplanation">
                <!-- Explanation will be inserted here -->
            </div>
            
            <div class="recommendation">
                <h4><i class="fas fa-lightbulb"></i> Rekomendasi untuk Meningkatkan Mindfulness</h4>
                <ul id="recommendations">
                    <!-- Recommendations will be inserted here -->
                </ul>
            </div>
            
            <p><em>Catatan: Hasil ini adalah refleksi, bukan diagnosis. Konsultasikan dengan profesional untuk penilaian yang lebih mendalam.</em></p>
            
            <div class="final-actions">
                <button onclick="downloadResult()">
                    <i class="fas fa-file-download"></i> Unduh Hasil
                </button>
                <button class="btn-secondary" onclick="restartTest()">
                    <i class="fas fa-redo"></i> Ulang Tes
                </button>
            </div>
        </div>
    </main>

    <script>
        // Database soal
        const questions = [
            // MAAS Questions (15)
            { id: 1, type: "MAAS", text: "Saya bisa mengalami emosi tanpa menyadarinya sampai beberapa saat kemudian.", reverse: true },
            { id: 2, type: "MAAS", text: "Saya menjatuhkan atau memecahkan benda karena ceroboh, tidak memperhatikan, atau memikirkan hal lain.", reverse: true },
            { id: 3, type: "MAAS", text: "Saya kesulitan tetap fokus pada apa yang sedang terjadi saat ini.", reverse: true },
            { id: 4, type: "MAAS", text: "Saya cenderung berjalan cepat ke tujuan tanpa memperhatikan apa yang saya alami sepanjang jalan.", reverse: true },
            { id: 5, type: "MAAS", text: "Saya cenderung tidak memperhatikan perasaan ketegangan atau ketidaknyamanan fisik sampai benar-benar menarik perhatian saya.", reverse: true },
            { id: 6, type: "MAAS", text: "Saya lupa nama seseorang hampir segera setelah pertama kali diberitahu.", reverse: true },
            { id: 7, type: "MAAS", text: "Sepertinya saya 'berjalan otomatis' tanpa banyak kesadaran tentang apa yang saya lakukan.", reverse: true },
            { id: 8, type: "MAAS", text: "Saya terburu-buru melalui aktivitas tanpa benar-benar memperhatikannya.", reverse: true },
            { id: 9, type: "MAAS", text: "Saya menjadi sangat fokus pada tujuan yang ingin saya capai sehingga saya kehilangan kontak dengan apa yang saya lakukan sekarang untuk mencapainya.", reverse: true },
            { id: 10, type: "MAAS", text: "Saya melakukan pekerjaan atau tugas secara otomatis, tanpa menyadari apa yang saya lakukan.", reverse: true },
            { id: 11, type: "MAAS", text: "Saya mendapati diri saya mendengarkan seseorang dengan satu telinga, melakukan sesuatu yang lain pada saat yang sama.", reverse: true },
            { id: 12, type: "MAAS", text: "Saya mengemudi ke tempat dengan 'autopilot' dan kemudian bertanya-tanya mengapa saya pergi ke sana.", reverse: true },
            { id: 13, type: "MAAS", text: "Saya mendapati diri saya terpaku pada masa depan atau masa lalu.", reverse: true },
            { id: 14, type: "MAAS", text: "Saya mendapati diri saya melakukan sesuatu tanpa memperhatikan.", reverse: true },
            { id: 15, type: "MAAS", text: "Saya ngemil tanpa menyadari bahwa saya makan.", reverse: true },
            
            // FFMQ Questions (25)
            // Observing (5)
            { id: 16, type: "FFMQ-O", text: "Saya memperhatikan sensasi seperti angin di rambut atau matahari di wajah.", reverse: false },
            { id: 17, type: "FFMQ-O", text: "Saya memperhatikan suara-suara di sekitar, seperti jam berdetak, burung berkicau, atau mobil lewat.", reverse: false },
            { id: 18, type: "FFMQ-O", text: "Saya memperhatikan bagaimana makanan dan minuman memengaruhi pikiran, sensasi tubuh, dan emosi saya.", reverse: false },
            { id: 19, type: "FFMQ-O", text: "Saya memperhatikan elemen visual dalam seni atau alam, seperti warna, bentuk, tekstur, atau pola cahaya dan bayangan.", reverse: false },
            { id: 20, type: "FFMQ-O", text: "Saya memperhatikan aroma dan bau di sekitar saya.", reverse: false },
            
            // Describing (5)
            { id: 21, type: "FFMQ-D", text: "Saya mudah menemukan kata-kata untuk menggambarkan perasaan saya.", reverse: false },
            { id: 22, type: "FFMQ-D", text: "Saya dapat dengan mudah mengungkapkan keyakinan, pendapat, dan harapan saya dalam kata-kata.", reverse: false },
            { id: 23, type: "FFMQ-D", text: "Sulit bagi saya menemukan kata-kata untuk menggambarkan apa yang saya pikirkan.", reverse: true },
            { id: 24, type: "FFMQ-D", text: "Saya cenderung menerjemahkan sensasi tubuh ke dalam kata-kata.", reverse: false },
            { id: 25, type: "FFMQ-D", text: "Bahkan ketika saya sangat kesal, saya bisa menemukan cara untuk mengungkapkannya dengan kata-kata.", reverse: false },
            
            // Acting with Awareness (5)
            { id: 26, type: "FFMQ-A", text: "Saya mudah teralihkan.", reverse: true },
            { id: 27, type: "FFMQ-A", text: "Saya tidak memperhatikan apa yang saya lakukan karena melamun, khawatir, atau teralihkan.", reverse: true },
            { id: 28, type: "FFMQ-A", text: "Saya fokus pada tugas yang sedang saya kerjakan.", reverse: false },
            { id: 29, type: "FFMQ-A", text: "Saya melakukan aktivitas dengan terburu-buru tanpa benar-benar memperhatikannya.", reverse: true },
            { id: 30, type: "FFMQ-A", text: "Saya melakukan pekerjaan atau tugas secara otomatis tanpa menyadari apa yang saya lakukan.", reverse: true },
            
            // Non-Judging (5)
            { id: 31, type: "FFMQ-NJ", text: "Saya mengatakan pada diri sendiri bahwa saya seharusnya tidak merasakan apa yang saya rasakan.", reverse: true },
            { id: 32, type: "FFMQ-NJ", text: "Saya menilai apakah pikiran saya baik atau buruk.", reverse: true },
            { id: 33, type: "FFMQ-NJ", text: "Saya menilai diri sendiri karena memiliki emosi yang tidak rasional atau tidak tepat.", reverse: true },
            { id: 34, type: "FFMQ-NJ", text: "Saya cenderung mengevaluasi apakah persepsi saya benar atau salah.", reverse: true },
            { id: 35, type: "FFMQ-NJ", text: "Saya memberi label pada diri sendiri dengan kata-kata negatif seperti 'bodoh', 'tidak kompeten', atau 'buruk' ketika saya memiliki pikiran yang menyakitkan.", reverse: true },
            
            // Non-Reactivity (5)
            { id: 36, type: "FFMQ-NR", text: "Saya mengamati perasaan saya tanpa tersesat di dalamnya.", reverse: false },
            { id: 37, type: "FFMQ-NR", text: "Ketika saya memiliki pikiran atau gambaran yang menyakitkan, saya bisa mundur dan menyadarinya tanpa dikuasai olehnya.", reverse: false },
            { id: 38, type: "FFMQ-NR", text: "Ketika saya memiliki pikiran atau gambaran yang menyakitkan, saya merasa tenang segera setelahnya.", reverse: false },
            { id: 39, type: "FFMQ-NR", text: "Ketika saya memiliki pikiran atau gambaran yang menyakitkan, saya hanya menyadarinya dan membiarkannya berlalu.", reverse: false },
            { id: 40, type: "FFMQ-NR", text: "Ketika saya memiliki pikiran atau gambaran yang menyakitkan, saya dapat mengenalinya tanpa bereaksi.", reverse: false },
            
            // Validation Questions (5)
            { id: 41, type: "Validation", text: "Saya selalu menjawab pertanyaan dengan jujur dalam tes ini.", reverse: false },
            { id: 42, type: "Validation", text: "Saya membaca setiap pertanyaan dengan seksama sebelum menjawab.", reverse: false },
            { id: 43, type: "Validation", text: "Saya menjawab beberapa pertanyaan tanpa benar-benar membacanya.", reverse: true },
            { id: 44, type: "Validation", text: "Saya memilih jawaban secara acak untuk beberapa pertanyaan.", reverse: true },
            { id: 45, type: "Validation", text: "Saya memberikan perhatian penuh saat mengerjakan tes ini.", reverse: false },
            
            // Consistency Questions (5)
            { id: 46, type: "Consistency", text: "Saya menyadari apa yang saya lakukan saat ini.", reverse: false },
            { id: 47, type: "Consistency", text: "Saya sering tidak sadar dengan apa yang saya lakukan saat ini.", reverse: true },
            { id: 48, type: "Consistency", text: "Saya dapat dengan mudah menjelaskan apa yang saya rasakan.", reverse: false },
            { id: 49, type: "Consistency", text: "Saya kesulitan menjelaskan apa yang saya rasakan.", reverse: true },
            { id: 50, type: "Consistency", text: "Saya memperhatikan perubahan kecil dalam lingkungan sekitar saya.", reverse: false }
        ];
        
        // Shuffle questions but keep validation questions at specific positions
        function shuffleQuestions() {
            const validationQuestions = questions.filter(q => q.type === "Validation");
            const otherQuestions = questions.filter(q => q.type !== "Validation");
            
            // Shuffle other questions
            for (let i = otherQuestions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [otherQuestions[i], otherQuestions[j]] = [otherQuestions[j], otherQuestions[i]];
            }
            
            // Insert validation questions at specific positions
            const validationPositions = [6, 17, 28, 39, 46]; // 0-indexed (7, 18, 29, 40, 47 in 1-indexed)
            const finalQuestions = [...otherQuestions];
            
            validationPositions.forEach((pos, idx) => {
                finalQuestions.splice(pos, 0, validationQuestions[idx]);
            });
            
            return finalQuestions;
        }
        
        let shuffledQuestions = [];
        let currentQuestionIndex = 0;
        let answers = [];
        
        function startTest() {
            document.getElementById('introCard').style.display = 'none';
            document.getElementById('questionCard').style.display = 'block';
            
            shuffledQuestions = shuffleQuestions();
            currentQuestionIndex = 0;
            answers = Array(shuffledQuestions.length).fill(0);
            
            displayQuestion();
        }
        
        function displayQuestion() {
            const question = shuffledQuestions[currentQuestionIndex];
            document.getElementById('questionText').textContent = question.text;
            document.getElementById('currentNumber').textContent = currentQuestionIndex + 1;
            document.getElementById('progressBar').value = currentQuestionIndex + 1;
            
            // Clear radio button selection
            const radioButtons = document.querySelectorAll('input[name="answer"]');
            radioButtons.forEach(radio => {
                radio.checked = false;
            });
            
            // If there's a saved answer for this question, select it
            if (answers[currentQuestionIndex] > 0) {
                document.getElementById(`option${answers[currentQuestionIndex]}`).checked = true;
                document.getElementById('nextButton').disabled = false;
            } else {
                document.getElementById('nextButton').disabled = true;
            }
            
            // Enable/disable previous button
            document.getElementById('prevButton').disabled = currentQuestionIndex === 0;
        }
        
        function saveAnswer() {
            const selectedOption = document.querySelector('input[name="answer"]:checked');
            if (selectedOption) {
                answers[currentQuestionIndex] = parseInt(selectedOption.value);
                return true;
            }
            return false;
        }
        
        function nextQuestion() {
            if (saveAnswer()) {
                currentQuestionIndex++;
                
                if (currentQuestionIndex < shuffledQuestions.length) {
                    displayQuestion();
                } else {
                    // Show name input when all questions are answered
                    document.getElementById('questionCard').style.display = 'none';
                    document.getElementById('namaInputCard').style.display = 'block';
                }
            }
        }
        
        function prevQuestion() {
            saveAnswer();
            currentQuestionIndex--;
            displayQuestion();
        }
        
        // Add event listeners to radio buttons
        document.querySelectorAll('input[name="answer"]').forEach(radio => {
            radio.addEventListener('change', () => {
                document.getElementById('nextButton').disabled = false;
            });
        });
        
        function calculateScore() {
            let totalScore = 0;
            let validationScore = 0;
            let consistencyScore = 0;
            
            shuffledQuestions.forEach((question, index) => {
                let score = answers[index];
                
                // Apply reverse scoring if needed
                if (question.reverse) {
                    score = 6 - score; // 1->5, 2->4, 3->3, 4->2, 5->1
                }
                
                if (question.type === "Validation") {
                    validationScore += score;
                } else if (question.type === "Consistency") {
                    consistencyScore += score;
                } else {
                    totalScore += score;
                }
            });
            
            // Check for consistency in paired questions
            const consistencyPairs = [
                { q1: 46, q2: 47 }, // "Saya menyadari apa yang saya lakukan saat ini." vs "Saya sering tidak sadar dengan apa yang saya lakukan saat ini."
                { q1: 48, q2: 49 }  // "Saya dapat dengan mudah menjelaskan apa yang saya rasakan." vs "Saya kesulitan menjelaskan apa yang saya rasakan."
            ];
            
            let inconsistencyDetected = false;
            
            consistencyPairs.forEach(pair => {
                const q1Index = shuffledQuestions.findIndex(q => q.id === pair.q1);
                const q2Index = shuffledQuestions.findIndex(q => q.id === pair.q2);
                
                if (q1Index !== -1 && q2Index !== -1) {
                    let score1 = answers[q1Index];
                    let score2 = answers[q2Index];
                    
                    // Apply reverse scoring if needed
                    if (shuffledQuestions[q1Index].reverse) {
                        score1 = 6 - score1;
                    }
                    if (shuffledQuestions[q2Index].reverse) {
                        score2 = 6 - score2;
                    }
                    
                    // Check if answers are inconsistent (difference > 2)
                    if (Math.abs(score1 - (6 - score2)) > 2) {
                        inconsistencyDetected = true;
                    }
                }
            });
            
            // Check for extreme patterns (all 1s or all 5s)
            const allSame = answers.every(a => a === answers[0]);
            
            return {
                totalScore: totalScore,
                validationScore: validationScore,
                inconsistencyDetected: inconsistencyDetected || allSame || validationScore < 15 // Threshold for validation
            };
        }
        
        function getCategory(score) {
            if (score >= 200) return "Sangat Tinggi";
            if (score >= 150) return "Cukup Baik";
            if (score >= 100) return "Perlu Dilatih";
            return "Cenderung Tidak Mindful";
        }
        
        function getExplanation(category) {
            switch (category) {
                case "Sangat Tinggi":
                    return "Anda memiliki tingkat kesadaran reflektif yang sangat baik. Anda cenderung hadir sepenuhnya dalam momen saat ini dan mampu mengenali pikiran, perasaan, dan sensasi tubuh tanpa terjebak di dalamnya. Kemampuan mindfulness Anda membantu mengurangi stres dan meningkatkan kualitas hidup secara keseluruhan.";
                case "Cukup Baik":
                    return "Anda cenderung sadar dan hadir dalam kehidupan sehari-hari. Meskipun terkadang masih terdistraksi, Anda memiliki kemampuan yang baik untuk kembali ke momen saat ini. Dengan latihan yang konsisten, Anda dapat meningkatkan kemampuan mindfulness Anda ke level yang lebih tinggi.";
                case "Perlu Dilatih":
                    return "Anda masih sering terjebak dalam distraksi dan reaksi otomatis. Meskipun Anda memiliki momen-momen mindfulness, kesadaran Anda sering kali teralihkan oleh pikiran tentang masa lalu atau masa depan. Latihan mindfulness secara teratur akan sangat bermanfaat untuk meningkatkan kesadaran Anda.";
                case "Cenderung Tidak Mindful":
                    return "Anda sering kali beroperasi dalam mode 'autopilot' dan kurang menyadari pengalaman saat ini. Pikiran Anda mungkin sering terjebak dalam kekhawatiran tentang masa depan atau penyesalan tentang masa lalu. Memulai praktik mindfulness dasar dapat membantu Anda mengembangkan kesadaran yang lebih besar dalam kehidupan sehari-hari.";
                default:
                    return "";
            }
        }
        
        function getRecommendations(category) {
            const commonRecs = [
                "Luangkan 5-10 menit setiap hari untuk meditasi pernapasan sederhana.",
                "Praktikkan makan dengan penuh kesadaran setidaknya satu kali sehari.",
                "Lakukan journaling reflektif setiap malam sebelum tidur."
            ];
            
            let specificRecs = [];
            
            switch (category) {
                case "Sangat Tinggi":
                    specificRecs = [
                        "Bagikan pengalaman mindfulness Anda dengan orang lain melalui diskusi atau mentoring.",
                        "Eksplorasi praktik mindfulness yang lebih mendalam seperti meditasi loving-kindness atau body scan.",
                        "Integrasikan mindfulness ke dalam aktivitas kreatif seperti seni atau musik."
                    ];
                    break;
                case "Cukup Baik":
                    specificRecs = [
                        "Tingkatkan durasi meditasi harian Anda secara bertahap.",
                        "Praktikkan 'pause practice' - berhenti sejenak dan bernapas setiap kali mendengar notifikasi ponsel.",
                        "Coba latihan 'mindful walking' saat berjalan ke tempat kerja atau di taman."
                    ];
                    break;
                case "Perlu Dilatih":
                    specificRecs = [
                        "Mulai dengan meditasi pernapasan singkat 3-5 menit dan tingkatkan secara bertahap.",
                        "Gunakan pengingat visual (seperti stiker atau wallpaper ponsel) untuk mengingatkan diri agar kembali ke momen saat ini.",
                        "Praktikkan 'STOP' technique: Stop, Take a breath, Observe, Proceed."
                    ];
                    break;
                case "Cenderung Tidak Mindful":
                    specificRecs = [
                        "Mulai dengan latihan 'one mindful breath' - satu napas penuh kesadaran setiap jam.",
                        "Kurangi multitasking dan fokus pada satu aktivitas pada satu waktu.",
                        "Coba aplikasi mindfulness pemula seperti Headspace atau Calm untuk panduan terstruktur."
                    ];
                    break;
            }
            
            // Add Islamic recommendations
            const islamicRecs = [
                "Praktikkan dzikir dengan penuh kesadaran setelah shalat.",
                "Lakukan shalat dengan lebih khusyuk, merasakan setiap gerakan dan bacaan.",
                "Baca Al-Qur'an dengan tadabbur (perenungan makna) meskipun hanya beberapa ayat setiap hari."
            ];
            
            return [...specificRecs, ...commonRecs, ...islamicRecs];
        }
        
        function tampilkanHasil() {
            const userName = document.getElementById('userName').value.trim();
            
            if (!userName) {
                alert('Silakan masukkan nama Anda terlebih dahulu.');
                return;
            }
            
            const result = calculateScore();
            const category = getCategory(result.totalScore);
            const explanation = getExplanation(category);
            const recommendations = getRecommendations(category);
            
            // Display user name
            document.getElementById('displayUserName').textContent = userName;
            
            // Display date
            const today = new Date();
            const formattedDate = today.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            document.getElementById('testDate').textContent = formattedDate;
            
            // Display score and category
            document.getElementById('finalScore').textContent = result.totalScore;
            document.getElementById('resultCategory').textContent = category;
            
            // Display explanation
            document.getElementById('resultExplanation').textContent = explanation;
            
            // Display recommendations
            const recList = document.getElementById('recommendations');
            recList.innerHTML = '';
            recommendations.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = rec;
                recList.appendChild(li);
            });
            
            // Show validation warning if needed
            if (result.inconsistencyDetected) {
                document.getElementById('validationWarning').style.display = 'block';
            } else {
                document.getElementById('validationWarning').style.display = 'none';
            }
            
            // Show result card
            document.getElementById('namaInputCard').style.display = 'none';
            document.getElementById('resultCard').style.display = 'block';
        }
        
        function downloadResult() {
            const element = document.getElementById('resultCard');
            const userName = document.getElementById('displayUserName').textContent;
            
            const opt = {
                margin: 1,
                filename: `Hasil_Tes_Mindfulness_${userName.replace(/\s+/g, '_')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            // Clone the element to modify it for PDF
            const clonedElement = element.cloneNode(true);
            
            // Add header with logo for PDF
            const header = document.createElement('div');
            header.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h1 style="color: #02504e; margin-bottom: 5px;">Hasil Tes Mindfulness Profesional</h1>
                    <p style="color: #00a896;">Laporan Evaluasi Kesadaran dan Kehadiran</p>
                </div>
            `;
            clonedElement.prepend(header);
            
            // Add footer
            const footer = document.createElement('div');
            footer.innerHTML = `
                <div style="margin-top: 30px; text-align: center; font-size: 12px; color: #4b5563;">
                    <p>Dokumen ini dibuat pada ${document.getElementById('testDate').textContent}</p>
                    <p>© ${new Date().getFullYear()} Tes Mindfulness Profesional</p>
                </div>
            `;
            clonedElement.appendChild(footer);
            
            // Generate PDF
            html2pdf().from(clonedElement).set(opt).save();
        }
        
        function restartTest() {
            document.getElementById('resultCard').style.display = 'none';
            document.getElementById('introCard').style.display = 'block';
            
            // Reset answers
            answers = [];
            currentQuestionIndex = 0;
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'966b9753c561f9e6',t:'MTc1Mzc4MTM1OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
